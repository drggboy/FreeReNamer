---
description: ä¼˜å…ˆçº§å’Œæ•°æ®æµé—®é¢˜çš„è°ƒè¯•æ–¹æ³•
---

# ä¼˜å…ˆçº§å’Œæ•°æ®æµé—®é¢˜è°ƒè¯•æŒ‡å—

## é—®é¢˜è¯†åˆ«æ¨¡å¼

### ç”¨æˆ·è¾“å…¥è¢«è¦†ç›–é—®é¢˜
**ç—‡çŠ¶**ï¼šç”¨æˆ·è¾“å…¥äº†Aï¼Œä½†æœ€ç»ˆåº”ç”¨çš„æ˜¯B
**å¸¸è§åŸå› **ï¼š
1. useEffectä¾èµ–å¯¼è‡´çŠ¶æ€è¢«é‡ç½®
2. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶çŠ¶æ€åˆå§‹åŒ–é€»è¾‘é”™è¯¯
3. çˆ¶ç»„ä»¶çŠ¶æ€æ›´æ–°è¦†ç›–å­ç»„ä»¶çŠ¶æ€

### è°ƒè¯•æ­¥éª¤

#### 1. è·Ÿè¸ªçŠ¶æ€å˜åŒ–
```typescript
// æ·»åŠ è°ƒè¯•æ—¥å¿—è·Ÿè¸ªçŠ¶æ€å˜åŒ–
useEffect(() => {
  console.log('ğŸ” [Debug] manualName changed:', manualName);
}, [manualName]);

useEffect(() => {
  console.log('ğŸ” [Debug] fileItemInfo changed:', fileItemInfo?.preview);
}, [fileItemInfo]);
```

#### 2. æ£€æŸ¥useEffectä¾èµ–
```typescript
// æ£€æŸ¥æ˜¯å¦æœ‰æ„å¤–çš„ä¾èµ–å¯¼è‡´é‡ç½®
useEffect(() => {
  // è¿™é‡Œå¯èƒ½æœ‰é—®é¢˜ï¼šæ¯æ¬¡fileItemInfoæ›´æ–°éƒ½é‡ç½®
  setManualName(fileItemInfo?.preview);
}, [fileItemInfo]); // âŒ å¯èƒ½å¯¼è‡´ç”¨æˆ·è¾“å…¥è¢«è¦†ç›–
```

#### 3. éªŒè¯refæš´éœ²çš„æ–¹æ³•
```typescript
// åœ¨æ‰§è¡Œæ—¶æ·»åŠ è°ƒè¯•
const finalName = fileRef.current?.getFinalName();
console.log('ğŸ” [Debug] getFinalName():', finalName);
console.log('ğŸ” [Debug] getManualName():', fileRef.current?.getManualName());
```

#### 4. æ£€æŸ¥æ•°æ®æµ
```typescript
// è·Ÿè¸ªä»UIæ˜¾ç¤ºåˆ°æ‰§è¡Œçš„å®Œæ•´æ•°æ®æµ
console.log('ğŸ” [Debug] UIæ˜¾ç¤º:', document.querySelector('[data-manual-name]')?.textContent);
console.log('ğŸ” [Debug] ç»„ä»¶çŠ¶æ€:', manualName);
console.log('ğŸ” [Debug] æ‰§è¡Œä½¿ç”¨:', targetName);
```

## å¸¸è§é—®é¢˜æ¨¡å¼

### æ¨¡å¼1ï¼šåˆå§‹åŒ–è¦†ç›–
```typescript
// âŒ é—®é¢˜ä»£ç 
useEffect(() => {
  setUserInput(externalData.value);
}, [externalData]);

// âœ… ä¿®å¤ä»£ç 
useEffect(() => {
  if (!hasUserModifications) {
    setUserInput(externalData.value);
  }
}, [externalData, hasUserModifications]);
```

### æ¨¡å¼2ï¼šæ˜¾ç¤ºä¸çŠ¶æ€ä¸ä¸€è‡´
```typescript
// ç¡®ä¿æ˜¾ç¤ºé€»è¾‘ä¸refæ–¹æ³•ä¸€è‡´
const displayValue = manualName || (fileItemInfo?.preview || fileItemInfo?.fileInfo.fullName);
const getFinalName = () => manualName || (fileItemInfo?.preview || fileItemInfo?.fileInfo.fullName || '');
```

### æ¨¡å¼3ï¼šæ‰§è¡Œé€»è¾‘å¤æ‚åŒ–
```typescript
// âŒ å¤æ‚çš„æ¡ä»¶åˆ¤æ–­
if (hasManualRename) {
  targetName = manualName;
} else {
  targetName = ruleOutput;
}

// âœ… ç®€åŒ–ä¸ºç»Ÿä¸€æ¥å£
const finalName = fileRef.current?.getFinalName();
if (finalName && finalName.trim()) {
  targetName = finalName;
}
```

## è°ƒè¯•å·¥å…·

### 1. React DevTools
- æ£€æŸ¥ç»„ä»¶çŠ¶æ€å˜åŒ–
- è·Ÿè¸ªpropså’Œstate
- æŸ¥çœ‹effectæ‰§è¡Œæ—¶æœº

### 2. æ§åˆ¶å°è°ƒè¯•
```typescript
// å…¨å±€è°ƒè¯•å‡½æ•°
window.__DEBUG_FILE_ITEM__ = (file: string) => {
  const ref = window.__FILE_ITEM_REFS__?.get(file);
  if (ref?.current) {
    console.log('=== File Item Debug ===');
    console.log('Final Name:', ref.current.getFinalName());
    console.log('Manual Name:', ref.current.getManualName());
    console.log('Has Pending:', ref.current.hasPendingRename());
  }
};
```

### 3. ä¸´æ—¶æ–­ç‚¹
```typescript
// åœ¨å…³é”®è·¯å¾„æ·»åŠ æ–­ç‚¹
debugger; // åœ¨æ‰§è¡Œé€»è¾‘å‰åœæ­¢
const finalName = fileRef.current?.getFinalName();
```

## é¢„é˜²æªæ–½

1. **çŠ¶æ€åŒæ­¥è§„åˆ™**ï¼šæ˜ç¡®å®šä¹‰ä½•æ—¶åŒæ­¥å¤–éƒ¨æ•°æ®
2. **æ¥å£ä¸€è‡´æ€§**ï¼šç¡®ä¿æ˜¾ç¤ºã€è·å–ã€æ‰§è¡Œä½¿ç”¨åŒä¸€å¥—é€»è¾‘
3. **è°ƒè¯•æ—¥å¿—**ï¼šåœ¨å…³é”®çŠ¶æ€å˜åŒ–ç‚¹æ·»åŠ æ—¥å¿—
4. **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•è¾¹ç•Œæƒ…å†µå’ŒçŠ¶æ€è½¬æ¢

## ç›¸å…³æ–‡ä»¶
- [src/components/file/file-item.tsx](mdc:src/components/file/file-item.tsx) - æ–‡ä»¶é¡¹çŠ¶æ€ç®¡ç†
- [src/routes/profile/route.tsx](mdc:src/routes/profile/route.tsx) - æ‰§è¡Œé€»è¾‘
- [src/lib/atoms](mdc:src/lib/atoms) - å…¨å±€çŠ¶æ€ç®¡ç†